-- Insertar permisos específicos para el módulo de cuentas
INSERT INTO Permisos (NombrePermiso, Descripcion, Codigo)
SELECT * FROM (
    SELECT 'Ver Mis Cuentas', 'Permite ver las cuentas bancarias propias', 'cuentas.view_own'
    UNION SELECT 'Ver Todas las Cuentas', 'Permite ver todas las cuentas bancarias del sistema', 'cuentas.view_all'
    UNION SELECT 'Agregar Cuenta', 'Permite agregar nuevas cuentas bancarias', 'cuentas.add'
    UNION SELECT 'Editar Cuenta', 'Permite editar cuentas bancarias', 'cuentas.edit'
    UNION SELECT 'Eliminar Cuenta', 'Permite eliminar cuentas bancarias', 'cuentas.delete'
    UNION SELECT 'Gestionar Cuentas', 'Permite gestionar todas las cuentas del sistema', 'cuentas.manage'
) AS nuevos_permisos
WHERE NOT EXISTS (
    SELECT 1 FROM Permisos WHERE Codigo = nuevos_permisos.Codigo
);

-- Asignar permisos a roles
-- Administrador (todos los permisos)
INSERT INTO Roles_Permisos (RolID, PermisoID)
SELECT r.RolID, p.PermisoID 
FROM Roles r, Permisos p
WHERE r.NombreRol = 'Administrador' AND p.Codigo LIKE 'cuentas.%'
AND NOT EXISTS (
    SELECT 1 FROM Roles_Permisos rp WHERE rp.RolID = r.RolID AND rp.PermisoID = p.PermisoID
);

-- Coordinador (todos los permisos)
INSERT INTO Roles_Permisos (RolID, PermisoID)
SELECT r.RolID, p.PermisoID 
FROM Roles r, Permisos p
WHERE r.NombreRol = 'Coordinador' AND p.Codigo LIKE 'cuentas.%'
AND NOT EXISTS (
    SELECT 1 FROM Roles_Permisos rp WHERE rp.RolID = r.RolID AND rp.PermisoID = p.PermisoID
);

-- Participante (solo ver y gestionar sus propias cuentas)
INSERT INTO Roles_Permisos (RolID, PermisoID)
SELECT r.RolID, p.PermisoID 
FROM Roles r, Permisos p
WHERE r.NombreRol = 'Participante' AND p.Codigo IN ('cuentas.view_own', 'cuentas.add', 'cuentas.edit', 'cuentas.delete')
AND NOT EXISTS (
    SELECT 1 FROM Roles_Permisos rp WHERE rp.RolID = r.RolID AND rp.PermisoID = p.PermisoID
);

-- Cobrador (solo ver cuentas)
INSERT INTO Roles_Permisos (RolID, PermisoID)
SELECT r.RolID, p.PermisoID 
FROM Roles r, Permisos p
WHERE r.NombreRol = 'Cobrador' AND p.Codigo = 'cuentas.view_all'
AND NOT EXISTS (
    SELECT 1 FROM Roles_Permisos rp WHERE rp.RolID = r.RolID AND rp.PermisoID = p.PermisoID
);

-- Auditor (solo ver cuentas)
INSERT INTO Roles_Permisos (RolID, PermisoID)
SELECT r.RolID, p.PermisoID 
FROM Roles r, Permisos p
WHERE r.NombreRol = 'Auditor' AND p.Codigo = 'cuentas.view_all'
AND NOT EXISTS (
    SELECT 1 FROM Roles_Permisos rp WHERE rp.RolID = r.RolID AND rp.PermisoID = p.PermisoID
);